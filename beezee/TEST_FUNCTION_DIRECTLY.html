<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Function CORS</title>
</head>
<body>
    <h1>Test Supabase Edge Function CORS</h1>
    <button onclick="testOptions()">Test OPTIONS Request</button>
    <button onclick="testPost()">Test POST Request</button>
    <pre id="results"></pre>

    <script>
        const FUNCTION_URL = 'https://rtfzksajhriwhulnwaks.supabase.co/functions/v1/verify-otp-custom';
        const ANON_KEY = 'YOUR_ANON_KEY_HERE'; // Replace with your actual anon key

        function log(message) {
            const results = document.getElementById('results');
            results.textContent += message + '\n';
            console.log(message);
        }

        async function testOptions() {
            log('\n=== Testing OPTIONS Request ===');
            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'OPTIONS',
                    headers: {
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'content-type, apikey'
                    }
                });
                
                log('OPTIONS Status: ' + response.status);
                log('OPTIONS Status Text: ' + response.statusText);
                
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                log('Response Headers: ' + JSON.stringify(headers, null, 2));
                
                if (response.status === 200) {
                    log('✅ OPTIONS works! CORS is configured correctly.');
                } else {
                    log('❌ OPTIONS failed with status ' + response.status);
                    log('This means the function is not returning 200 for OPTIONS');
                }
            } catch (error) {
                log('❌ Error: ' + error.message);
            }
        }

        async function testPost() {
            log('\n=== Testing POST Request ===');
            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': ANON_KEY
                    },
                    body: JSON.stringify({
                        whatsapp_number: '+14693065247',
                        code: '123456'
                    })
                });
                
                log('POST Status: ' + response.status);
                const data = await response.json();
                log('POST Response: ' + JSON.stringify(data, null, 2));
            } catch (error) {
                log('❌ Error: ' + error.message);
            }
        }
    </script>
</body>
</html>

